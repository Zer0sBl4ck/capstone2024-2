<ion-header class="fondo">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button routerLink="/tabs/home">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="titulo">Solicitudes de Pr√©stamo</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <ion-refresher slot="fixed" (ionRefresh)="refreshData($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Botones para alternar entre solicitudes recibidas y realizadas -->
  <ion-segment value="recibi" (ionChange)="alternarSolicitudes($event)">
    <ion-segment-button class="reci" value="recibidas">Solicitudes Recibidas
    </ion-segment-button>
    <ion-segment-button class="reali" value="realizadas">Solicitudes Realizadas
    </ion-segment-button>
  </ion-segment>

  <!-- Mostrar solicitudes recibidas -->
  <ng-container *ngIf="mostrarRecibidas">
    <ion-list class="rec" *ngIf="solicitudesRecibidas.length > 0; else noSolicitudesRecibidas">
      <ion-item *ngFor="let solicitud of solicitudesRecibidas">
        <ion-label>
          <h2>Libro: {{ solicitud.titulo }}</h2>
          <p>Estado: {{ solicitud.estado_prestamo }}</p>
          <p>Correo solicitante: {{ solicitud.correo_2 }}</p>
          <p>Fecha devoluci√≥n: {{ solicitud.fecha_prestamo | date: 'dd-MM-yyyy' }}</p>
          <p>{{ solicitud.nombre_usuario }}</p>
        </ion-label>
        <!-- pendiente -->
        <ion-button class="aceptar" *ngIf="solicitud.estado_prestamo === 'pendiente'"
          (click)="modificarEstadoSolicitud(solicitud.id_prestamo)">Aceptar</ion-button>
        <ion-button class="rechazar" *ngIf="solicitud.estado_prestamo === 'pendiente'"
          (click)="eliminarSolicitud(solicitud.id_prestamo)">Rechazar</ion-button>
          <ion-button *ngIf="solicitud.estado_prestamo === 'Rese√±a Exitosa'" (click)="abrirFormularioResena(solicitud)">
            Dar Rese√±a
          </ion-button>
        <!-- desarollo -->
        <ion-button class="rechazar" *ngIf="solicitud.estado_prestamo === 'desarollo'"
        (click)="eliminarSolicitud(solicitud.id_prestamo)">Rechazar</ion-button>
        <ion-button class="devolucion" *ngIf="solicitud.estado_prestamo === 'desarrollo'"
        (click)="modificarFechaDevolucion(solicitud.id_prestamo, solicitud.correo_2)">
        Fecha devoluci√≥n
      </ion-button>
        <!-- entregado -->
        <ion-button class="entregar" *ngIf="solicitud.estado_prestamo === 'Por entregar'"
        (click)="marcarEstadoComoEntregado(solicitud.id_prestamo)">Marcar entregado</ion-button>
        <ion-button (click)="reportarUsuario(solicitud.id_solicitante, solicitud.id_prestamista)"
        *ngIf="solicitud.estado_prestamo === 'Por entregar'|| solicitud.estado_prestamo === 'entregado'|| solicitud.estado_prestamo === 'Libro devuelto'  || solicitud.estado_prestamo === 'Entrega confirmada' ">
        Reportar al solicitante
      </ion-button>
      <ion-button class="rechazar" *ngIf="solicitud.estado_prestamo === 'Libro devuelto'"
      (click)="cambiarEstado(solicitud.id_prestamo,'Devolucion confirmada')">Confirmar devolucion</ion-button>
      <ion-button *ngIf="solicitud.estado_prestamo !== 'pendiente'" (click)="obtenerIdChat(solicitud.id_prestamo)">CHATEAR</ion-button>      
        <ion-button class="aceptar" *ngIf="solicitud.estado_prestamo === 'aceptado'"
          (click)="cambiarEstado(solicitud.id_prestamo,'Por entregar')">
          Prestar
        </ion-button>
        <ion-button class="rechazar"
          *ngIf="solicitud.estado_prestamo === 'desarrollo' || solicitud.estado_prestamo === 'aceptado'"
          (click)="eliminarSolicitud(solicitud.id_prestamo)">
          Rechazar
        </ion-button>
      </ion-item>
    </ion-list>
    <ng-template #noSolicitudesRecibidas>
      <ion-card>
        <ion-card-header>
          <ion-card-title>No hay solicitudes recibidas ü•≤</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Actualmente no tienes solicitudes de pr√©stamo recibidas.</p>
        </ion-card-content>
      </ion-card>
    </ng-template>
  </ng-container>

  <!-- Mostrar solicitudes realizadas -->
  <ng-container *ngIf="!mostrarRecibidas">
    <ion-list class="rea" *ngIf="solicitudesRealizadas.length > 0; else noSolicitudesRealizadas">
      <ion-item *ngFor="let solicitud of solicitudesRealizadas">
        <ion-label>
          <h2>Libro: {{ solicitud.titulo }}</h2>
          <p>Estado: {{ solicitud.estado_prestamo }}</p>
          <p>Correo prestamista: {{ solicitud.correo }}</p>
          <p>Fecha: {{ solicitud.fecha_prestamo | date: 'dd-MM-yyyy' }}</p>
        </ion-label>
        <ion-button class="rechazar" *ngIf="solicitud.estado_prestamo === 'pendiente'"
        (click)="eliminarSolicitud1(solicitud.id_prestamo)">Cancelar solicitud</ion-button>
        <ion-button class="rechazar" *ngIf="solicitud.estado_prestamo === 'desarrollo'"
        (click)="eliminarSolicitud1(solicitud.id_prestamo)">Cancelar solicitud</ion-button>
        <ion-button class="rechazar" *ngIf="solicitud.estado_prestamo === 'entregado'"
        (click)="cambiarEstado(solicitud.id_prestamo,'Entrega confirmada')">Confirmar recepcion</ion-button>
        <ion-button class="rechazar" *ngIf="solicitud.estado_prestamo === 'Entrega confirmada'"
        (click)="cambiarEstado(solicitud.id_prestamo,'Libro devuelto')">Devolver libro</ion-button>
        <ion-button *ngIf="solicitud.estado_prestamo === 'Cancelado' && esSolicitante(solicitud)"
          (click)="eliminarSolicitud(solicitud.id_prestamo)">
          Eliminar
        </ion-button>
        <ion-button *ngIf="solicitud.estado_prestamo === 'Devolucion confirmada' && esSolicitante(solicitud)"
          (click)="irAResena(solicitud.id_prestamo)">
          Agregar Rese√±a libro
        </ion-button>
        <ion-button *ngIf="solicitud.estado_prestamo !== 'pendiente'" (click)="obtenerIdChat(solicitud.id_prestamo)">CHATEAR</ion-button>
        <ion-button (click)="reportarUsuario(solicitud.id_prestamista,solicitud.id_solicitante)"
        *ngIf="solicitud.estado_prestamo === 'Por entregar'|| solicitud.estado_prestamo === 'entregado'|| solicitud.estado_prestamo === 'Libro devuelto'  || solicitud.estado_prestamo === 'Entrega confirmada' ">
        Reportar due√±o
      </ion-button>
      </ion-item>
    </ion-list>
    <ng-template #noSolicitudesRealizadas>
      <ion-card>
        <ion-card-header>
          <ion-card-title>No hay solicitudes realizadas ü•≤</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Actualmente no has realizado ninguna solicitud de pr√©stamo.</p>
        </ion-card-content>
      </ion-card>
    </ng-template>
  </ng-container>
</ion-content>